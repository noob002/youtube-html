<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube 영상 검색</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        color: white;
        background: linear-gradient(to bottom, #1a1a1a, #0d0d0d, #1a1a1a);
        background-attachment: fixed;
        overflow-x: hidden;
    }
    header {
        padding: 15px;
        text-align: center;
        background-color: rgba(0,0,0,0.8);
        font-size: 24px;
        user-select: none;
    }
    header .youtube {
        color: red;
        cursor: pointer;
        font-weight: bold;
    }
    header .search-text {
        background: linear-gradient(90deg, #ff7eb3, #ff758c, #42a5f5, #7e57c2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradientShift 5s infinite linear;
        cursor: pointer;
    }
    @keyframes gradientShift {
        0% {background-position: 0%;}
        100% {background-position: 100%;}
    }
    .search-container {
        display: flex;
        justify-content: center;
        padding: 20px;
        flex-wrap: wrap;
    }
    .search-container input, .search-container select {
        padding: 10px;
        margin: 5px;
        font-size: 16px;
        border: 1px solid #333;
        background-color: #222;
        color: white;
        border-radius: 4px;
    }
    .search-container button {
        padding: 10px 15px;
        background-color: #ff5722;
        border: none;
        color: white;
        cursor: pointer;
        border-radius: 4px;
    }
    .search-container button:hover {
        background-color: #e64a19;
    }
    #results {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
        padding: 20px;
    }
    .video-card {
        background-color: #181818;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.2s ease;
    }
    .video-card:hover {
        transform: translateY(-5px);
    }
    .video-card img {
        width: 100%;
        height: 170px;
        object-fit: cover;
    }
    .video-card h3 {
        font-size: 16px;
        margin: 10px;
    }
    .video-card p {
        font-size: 13px;
        margin: 0 10px 10px;
        color: #aaa;
    }
    #loadingSpinner {
        display: none;
        text-align: center;
        padding: 20px;
    }
    .recent-searches {
        text-align: center;
        margin-top: 10px;
        color: #ccc;
        font-size: 14px;
    }
    .recent-searches span {
        margin: 0 5px;
        cursor: pointer;
        text-decoration: underline;
    }
</style>
</head>
<body>

<header>
    <span class="youtube" onclick="goToYouTube()">YouTube</span>
    <span class="search-text" onclick="refreshPage()"> 영상 검색</span>
</header>

<div class="search-container">
    <input type="text" id="query" placeholder="검색어를 입력하세요...">
    <select id="dateFilter">
        <option value="">전체 기간</option>
        <option value="today">오늘</option>
        <option value="week">이번 주</option>
        <option value="month">이번 달</option>
    </select>
    <select id="sortFilter">
        <option value="relevance">관련성</option>
        <option value="date">업로드 날짜</option>
        <option value="viewCount">조회수</option>
    </select>
    <button onclick="searchVideos(true)">검색</button>
</div>

<div class="recent-searches" id="recentSearches"></div>
<div id="loadingSpinner">⏳ 로딩 중...</div>
<div id="results"></div>

<script>
const API_KEY = "AIzaSyDB1hVGyJfVBxqaYJ0Xn-DlX7U2hPRpgQ8";
let nextPageToken = "";
let currentQuery = "";
let isLoading = false;

document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("keydown", e => {
    if (e.key === "F12" || (e.ctrlKey && e.shiftKey && e.key === "I")) {
        e.preventDefault();
    }
});

function goToYouTube() {
    window.location.href = "https://www.youtube.com";
}
function refreshPage() {
    location.reload();
}

function showRecentSearches() {
    const searches = JSON.parse(localStorage.getItem("recentSearches") || "[]");
    const container = document.getElementById("recentSearches");
    container.innerHTML = searches.map(q => `<span onclick="searchFromHistory('${q}')">${q}</span>`).join("");
}
function saveSearch(query) {
    let searches = JSON.parse(localStorage.getItem("recentSearches") || "[]");
    searches = [query, ...searches.filter(q => q !== query)].slice(0, 5);
    localStorage.setItem("recentSearches", JSON.stringify(searches));
}
function searchFromHistory(query) {
    document.getElementById("query").value = query;
    searchVideos(true);
}

async function searchVideos(isNewSearch = false) {
    if (isLoading) return;
    isLoading = true;
    document.getElementById("loadingSpinner").style.display = "block";

    if (isNewSearch) {
        document.getElementById("results").innerHTML = "";
        nextPageToken = "";
        currentQuery = document.getElementById("query").value.trim();
        saveSearch(currentQuery);
    }
    if (!currentQuery) {
        document.getElementById("loadingSpinner").style.display = "none";
        isLoading = false;
        return;
    }

    let dateFilter = document.getElementById("dateFilter").value;
    let publishedAfter = "";
    if (dateFilter === "today") {
        publishedAfter = new Date(Date.now() - 24*60*60*1000).toISOString();
    } else if (dateFilter === "week") {
        publishedAfter = new Date(Date.now() - 7*24*60*60*1000).toISOString();
    } else if (dateFilter === "month") {
        publishedAfter = new Date(Date.now() - 30*24*60*60*1000).toISOString();
    }

    let order = document.getElementById("sortFilter").value;

    let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(currentQuery)}&type=video&maxResults=20&order=${order}&key=${API_KEY}`;
    if (publishedAfter) url += `&publishedAfter=${publishedAfter}`;
    if (nextPageToken) url += `&pageToken=${nextPageToken}`;

    try {
        const res = await fetch(url);
        const data = await res.json();
        if (data.error) {
            document.getElementById("results").innerHTML = `<p style="text-align:center;color:red;">API 오류: ${data.error.message}</p>`;
            return;
        }
        if (!data.items.length) {
            document.getElementById("results").innerHTML = `<p style="text-align:center;color:#aaa;">검색 결과 없음</p>`;
            return;
        }

        nextPageToken = data.nextPageToken || "";
        const results = document.getElementById("results");
        data.items.forEach(item => {
            const videoId = item.id.videoId;
            const videoCard = document.createElement("div");
            videoCard.className = "video-card";
            videoCard.innerHTML = `
                <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">
                    <img src="${item.snippet.thumbnails.high.url}" alt="${item.snippet.title}">
                    <h3>${item.snippet.title}</h3>
                    <p>${item.snippet.description}</p>
                </a>
            `;
            results.appendChild(videoCard);
        });
    } catch (err) {
        console.error(err);
        document.getElementById("results").innerHTML = `<p style="text-align:center;color:red;">네트워크 오류</p>`;
    } finally {
        document.getElementById("loadingSpinner").style.display = "none";
        isLoading = false;
        showRecentSearches();
    }
}

document.getElementById("query").addEventListener("keypress", e => {
    if (e.key === "Enter") searchVideos(true);
});
window.addEventListener("scroll", () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
        if (nextPageToken) searchVideos(false);
    }
});

showRecentSearches();
</script>
</body>
</html>
